local engine = {}

local function compile (source, lookup)
  return source:gsub ("([%$%?%.]){([^}]*)}", lookup)
end

--[[
templates:
${name} replaced by the value of name
?{name}{true}{false} if name is true (not nil/false) then the next block is "executed" otherwise the optional false block is executed
${name}.{key} replaced by the value of name[key]
]]

function engine.compile (source, vals)
  return compile (source, function (control, arg)
    if control == "?" then
      return tostring (arg)
    elseif control == "." then
      return tostring (arg)
    elseif control == "$" then
      -- TODO: Table lookup

      return tostring (vals [arg])
    end
  end)
end

engine.raw_compile = compile

return engine
