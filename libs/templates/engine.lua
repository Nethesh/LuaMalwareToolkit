local engine = {}

local function compile (source, lookup)
  return source:gsub ("([%$%?%.]){([^}]*)}", lookup)
end

function engine.compile (source, vals)
  return compile (source, function (control, arg)
    if control == "?" then
      return tostring (arg)
    elseif control == "." then
      return tostring (arg)
    elseif control == "$" then
      return tostring (vals [string.upper (arg)])
    end
  end)
end

return engine
