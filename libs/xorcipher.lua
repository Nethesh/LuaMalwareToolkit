local xor

if bit then
  xor = bit.bxor
else
  xor = load ("return function (a, b) return a ~ b end")()
end

local xorcipher = {}

xorcipher.crypt = function (data, key)
    local klen = #key
    local s = {}
    for i = 1, #data do
      local k = string.byte (key, (i % klen) + 1)
      local d = string.byte (data, i)
      table.insert (s, string.char( xor (d, k)))
    end
    return table.concat (s, "")
end

xorcipher.decrypt = xorcipher.crypt

return xorcipher
